@inject DB db
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewBag.Title | NGO Management System</title>
    <link rel="shortcut icon" href="/images/favicon.png">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pager.css">
    <link rel="stylesheet" href="/css/app.css" asp-append-version="true">

    <style>
        .nav-item.dropdown .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            z-index: 1000;
        }

        .nav-item.dropdown:hover .dropdown-menu {
            display: block;
        }

        .nav-item.dropdown .dropdown-menu {
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .nav-item.dropdown {
            position: relative;
        }
    </style>

    @RenderSection("Styles", false)
    @RenderSection("head", false)
    @RenderSection("foot", false)
</head>
<body data-authenticated="@(User.Identity.IsAuthenticated ? "true" : "false")">

    <!-- Alert Container -->
    @if (TempData["Info"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show mb-0" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            @Html.Raw(TempData["Info"])
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Warning"] != null)
    {
        <div class="alert alert-warning alert-dismissible fade show mb-0" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i>
            @Html.Raw(TempData["Warning"])
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show mb-0" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            @Html.Raw(TempData["Error"])
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    }

    <!-- Header -->
    <header class="bg-success text-white py-3">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <h1 class="h3 mb-0">
                        <a href="/" class="text-white text-decoration-none">
                            <i class="fas fa-hands-helping me-2"></i>
                            NGO Management System
                        </a>
                    </h1>
                </div>
                <div class="col-md-6">
                    @if (User.Identity!.IsAuthenticated)
                    {
                        <div class="d-flex align-items-center justify-content-md-end">
                            @* Profile photos for Members and Organisers *@
                            @if (User.IsInRole("Member"))
                            {
                                var member = db.Members.Find(User.Identity!.Name);
                                if (member?.PhotoURL != null)
                                {
                                    <img src="/photos/@member.PhotoURL" class="rounded-circle me-2 border border-light" width="40" height="40" alt="Profile" style="object-fit: cover;" />
                                }
                            }
                            @if (User.IsInRole("Organiser"))
                            {
                                var organiser = db.Organisers.Find(User.Identity!.Name);
                                if (organiser?.PhotoURL != null)
                                {
                                    <img src="/photos/@organiser.PhotoURL" class="rounded-circle me-2 border border-light" width="40" height="40" alt="Profile" style="object-fit: cover;" />
                                }
                            }
                            <div class="text-end">
                                <div class="fw-semibold">@User.Identity.Name</div>
                                <div>
                                    @if (User.IsInRole("Admin"))
                                    {
                                        <span class="badge bg-light text-dark">Admin</span>
                                    }
                                    @if (User.IsInRole("Organiser"))
                                    {
                                        <span class="badge bg-light text-dark">Organiser</span>
                                    }
                                    @if (User.IsInRole("Member"))
                                    {
                                        <span class="badge bg-light text-dark">Member</span>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
        <div class="container">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <!-- Public Pages -->
                    <li class="nav-item">
                        <a class="nav-link btn btn-light" href="/Home/Index">
                            <i class="fas fa-home me-1"></i> Home
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link btn btn-light" href="/ContentPosting/Gallery">
                            <i class="fas fa-images me-1"></i> Gallery
                        </a>
                    </li>

                    <!-- Event Management -->
                    @if (User.IsInRole("Admin") || User.IsInRole("Organiser"))
                    {
                        <li class="nav-item dropdown">
                            <a class="nav-link btn btn-light" href="#" id="eventsDropdown" role="button">
                                <i class="fas fa-calendar me-1"></i> Events
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="eventsDropdown">
                                <li>
                                    <a class="dropdown-item" href="/NGO_Event_/Event_Index">
                                        <i class="fas fa-list me-2"></i> All Events
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/NGO_Event_/Event_Insert">
                                        <i class="fas fa-plus me-2"></i> Create Event
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/Recruitment/RecruitingInfo">
                                        <i class="fas fa-users me-2"></i> Volunteer Management
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/Feedback/FeedbackList">
                                        <i class="fas fa-users me-2"></i> View Feedback
                                    </a>
                                </li>
                            </ul>
                        </li>
                    }

                    <!-- Content Management -->
                    @if (User.Identity.IsAuthenticated)
                    {
                        <li class="nav-item dropdown">
                            <a class="nav-link btn btn-light" href="#" id="contentDropdown" role="button">
                                <i class="fas fa-edit me-1"></i> Content
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="contentDropdown">
                                <li>
                                    <a class="dropdown-item" href="/ContentPosting/Posting_Index">
                                        <i class="fas fa-folder me-2"></i> Your Posts
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/ContentPosting/Posting_Insert">
                                        <i class="fas fa-plus-circle me-2"></i> Create Post
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- History & Reports -->
                        <li class="nav-item dropdown">
                            <a class="nav-link btn btn-light" href="#" id="historyDropdown" role="button">
                                <i class="fas fa-history me-1"></i> History
                            </a>
                            <ul class="dropdown-menu" aria-labelledby="historyDropdown">
                                <li>
                                    <a class="dropdown-item" href="/EventHistory/Index">
                                        <i class="fas fa-calendar-check me-2"></i> Event History
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/EventHistory/MyVolunteer">
                                        <i class="fas fa-user-check me-2"></i> My Volunteer History
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="/EventHistory/Leaderboard">
                                        <i class="fas fa-trophy text-warning me-2"></i> Leaderboard
                                    </a>
                                </li>
                            </ul>
                        </li>
                    }
                </ul>

                <!-- Right side navigation -->
                <ul class="navbar-nav">
                    @if (User.Identity!.IsAuthenticated)
                    {
                        <!-- Admin/Organiser Dashboard -->
                        @* @if (User.IsInRole("Admin"))
                        {
                            <li class="nav-item">
                                <a class="nav-link btn btn-light" href="/Home/Admin">
                                    <i class="fas fa-cog me-1"></i> Admin Panel
                                </a>
                            </li>
                        } *@
                        @if (User.IsInRole("Organiser"))
                        {
                            <li class="nav-item">
                                <a class="nav-link btn btn-light" href="/Home/Organiser">
                                    <i class="fas fa-users me-1"></i> Organiser Panel
                                </a>
                            </li>
                        }

                        <!-- User Account -->
                        <li class="nav-item dropdown">
                            <a class="nav-link btn btn-light" href="#" id="accountDropdown" role="button">
                                <i class="fas fa-user me-1"></i> Account
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="accountDropdown">
                                @if (User.IsInRole("Member") || User.IsInRole("Organiser"))
                                {
                                    <li>
                                        <a class="dropdown-item" href="/UpdateProfile/Index">
                                            <i class="fas fa-edit me-2"></i> Update Profile
                                        </a>
                                    </li>
                                }
                                @if (User.IsInRole("Member"))
                                {
                                    <li>
                                        <a class="dropdown-item" href="/Account/RegisterOrganiser">
                                            <i class="fas fa-user-plus me-2"></i> Become Organiser
                                        </a>
                                    </li>
                                }
                                <li>
                                    <a class="dropdown-item" href="/Account/UpdatePassword">
                                        <i class="fas fa-key me-2"></i> Change Password
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="/Account/Logout">
                                        <i class="fas fa-sign-out-alt me-2"></i> Logout
                                    </a>
                                </li>
                            </ul>
                        </li>

                        <!-- Session Timer (if authenticated) -->
                        <li class="nav-item d-flex align-items-center btn btn-light">
                            <span id="sessionTimer" class="badge bg-secondary ms-2" style="display: none;">
                                <i class="fas fa-clock me-1"></i>
                                <span id="sessionTimeRemaining">--:--</span>
                            </span>
                        </li>
                    }
                    else
                    {
                        <!-- Guest Navigation -->
                        <li class="nav-item dropdown">
                            <a class="nav-link btn btn-light" href="#" id="authDropdown" role="button">
                                <i class="fas fa-sign-in-alt me-1"></i> Account
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="authDropdown">
                                <li>
                                    <a class="dropdown-item" href="/Account/Login">
                                        <i class="fas fa-sign-in-alt me-2"></i> Login
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="/Account/Register">
                                        <i class="fas fa-user-plus me-2"></i> Register as Member
                                    </a>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="/Account/RegisterOrganiser">
                                        <i class="fas fa-users me-2"></i> Register as Organiser
                                    </a>
                                </li>
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <a class="dropdown-item" href="/Account/ResetPassword">
                                        <i class="fas fa-key me-2"></i> Reset Password
                                    </a>
                                </li>
                            </ul>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="container my-4">
        @if (!string.IsNullOrEmpty(ViewBag.Title))
        {
            <div class="row mb-4">
                <div class="col-12">
                    <h1 class="border-bottom border-success pb-2">@ViewBag.Title</h1>
                </div>
            </div>
        }
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light text-center py-4 mt-5">
        <div class="container">
            <div class="row">
                <div class="col-md-6 text-md-start">
                    <p class="mb-0">
                        Developed by <strong>BAE SUZY</strong>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="mb-0">
                        Copyright &copy; @DateTime.Today.Year NGO Management System
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="/js/jquery.validate.min.js"></script>
    <script src="/js/jquery.validate.unobtrusive.min.js"></script>
    <script src="/js/app.js" asp-append-version="true"></script>

    @if (User.Identity.IsAuthenticated)
    {
        <script src="~/js/sessionTimeout.js"></script>
        <script>
            // Initialize session management
            $(document).ready(function() {
                // Show session indicator if available
                if (typeof sessionTimeRemaining !== 'undefined') {
                    $('#sessionTimer').show();
                }
            });
        </script>
    }

    <script>
        // Auto-hide alerts after 5 seconds
        $(document).ready(function() {
            setTimeout(function() {
                $('.alert').fadeOut('slow');
            }, 5000);
        });

        // Add active class to current navigation item
        $(document).ready(function() {
            var currentUrl = window.location.pathname;
            $('.navbar-nav .nav-link').each(function() {
                if ($(this).attr('href') === currentUrl) {
                    $(this).addClass('active');
                }
            });
        });
    </script>

    @RenderSection("Scripts", false)
</body>
</html>